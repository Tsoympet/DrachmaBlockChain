# Seed Node Deployment Guide

## Overview

This guide explains how to deploy and operate PARTHENON CHAIN seed nodes for mainnet. Seed nodes are critical infrastructure that help new nodes join the network and discover peers.

## Requirements

### Minimum Hardware
- **CPU:** 2+ cores
- **RAM:** 4GB minimum, 8GB recommended
- **Storage:** 100GB SSD (grows over time)
- **Network:** 100 Mbps with static IP or reliable DNS

### Operating System
- Ubuntu 20.04 LTS or newer
- Debian 11 or newer
- Other Linux distributions (manual configuration required)

### Network Requirements
- Static IP address or reliable DNS hostname
- Open firewall ports (9333 for mainnet, 19333 for testnet)
- Stable internet connection with low latency
- IPv6 support recommended but not required

## Quick Start

### 1. Install PARTHENON CHAIN

```bash
# Download the latest release
wget https://github.com/Tsoympet/PARTHENON-CHAIN/releases/download/v0.1.0/drachma-v0.1.0-linux-x86_64.tar.gz

# Verify checksum
wget https://github.com/Tsoympet/PARTHENON-CHAIN/releases/download/v0.1.0/drachma-v0.1.0-linux-x86_64.tar.gz.sha256
sha256sum -c drachma-v0.1.0-linux-x86_64.tar.gz.sha256

# Extract and install
tar -xzf drachma-v0.1.0-linux-x86_64.tar.gz
sudo cp drachmad drachma-cli /usr/local/bin/
sudo chmod +x /usr/local/bin/drachmad /usr/local/bin/drachma-cli
```

### 2. Deploy Seed Node

```bash
# Clone repository for deployment scripts
git clone https://github.com/Tsoympet/PARTHENON-CHAIN.git
cd PARTHENON-CHAIN

# Run deployment script
sudo ./scripts/deploy-seed-node.sh seed-node-1 mainnet
```

This script will:
- Create necessary directories
- Set up a dedicated `drachma` user
- Generate secure RPC credentials
- Create systemd service
- Configure log rotation

### 3. Start the Node

```bash
# Start the service
sudo systemctl start drachma-seed-node-1

# Enable auto-start on boot
sudo systemctl enable drachma-seed-node-1

# Check status
sudo systemctl status drachma-seed-node-1

# View logs
sudo journalctl -u drachma-seed-node-1 -f
```

### 4. Configure Firewall

```bash
# For mainnet
sudo ufw allow 9333/tcp
sudo ufw enable

# For testnet
sudo ufw allow 19333/tcp
sudo ufw enable
```

## Configuration

### Node Configuration File

Located at `/etc/drachma/seed-node-1.conf`:

```conf
# Network settings
network=mainnet
listen=1
maxconnections=125

# RPC settings (auto-generated credentials)
server=1
rpcuser=<auto-generated>
rpcpassword=<auto-generated>
rpcallowip=127.0.0.1
rpcport=8332

# Network ports
port=9333

# Logging
debug=net
debug=mempool
logips=1

# Performance
dbcache=512
maxmempool=300

# Seed node specific
discover=1
upnp=0
```

### Customizing Configuration

Edit `/etc/drachma/seed-node-1.conf` and restart the service:

```bash
sudo systemctl restart drachma-seed-node-1
```

## Multiple Seed Nodes

To run multiple seed nodes on the same machine (not recommended for production):

```bash
# Deploy additional nodes with different names
sudo ./scripts/deploy-seed-node.sh seed-node-2 mainnet /var/lib/drachma-seed-2
sudo ./scripts/deploy-seed-node.sh seed-node-3 mainnet /var/lib/drachma-seed-3
```

## Monitoring

### Basic Monitoring

```bash
# Check node status
drachma-cli -conf=/etc/drachma/seed-node-1.conf getinfo

# Check peer count
drachma-cli -conf=/etc/drachma/seed-node-1.conf getpeerinfo | grep "addr" | wc -l

# Check blockchain info
drachma-cli -conf=/etc/drachma/seed-node-1.conf getblockchaininfo

# Check network info
drachma-cli -conf=/etc/drachma/seed-node-1.conf getnettotals
```

### Log Files

Logs are stored in `/var/log/drachma/`:
- `seed-node-1.log` - Standard output
- `seed-node-1-error.log` - Error output

View real-time logs:
```bash
tail -f /var/log/drachma/seed-node-1.log
```

### Prometheus Metrics

If metrics are enabled (add `--metricsport=9311` to config):

```bash
curl http://localhost:9311/metrics
```

## Maintenance

### Updating the Node

```bash
# Download new release
wget https://github.com/Tsoympet/PARTHENON-CHAIN/releases/download/v0.2.0/drachma-v0.2.0-linux-x86_64.tar.gz

# Verify and extract
sha256sum -c drachma-v0.2.0-linux-x86_64.tar.gz.sha256
tar -xzf drachma-v0.2.0-linux-x86_64.tar.gz

# Stop node
sudo systemctl stop drachma-seed-node-1

# Replace binary
sudo cp drachmad /usr/local/bin/
sudo chmod +x /usr/local/bin/drachmad

# Start node
sudo systemctl start drachma-seed-node-1
```

### Backing Up

The blockchain data can be re-synced, but backup your wallet if you store one on the seed node:

```bash
# Backup wallet (if exists)
sudo cp /var/lib/drachma-seed-node-1/wallet.dat /backup/location/

# Backup configuration
sudo cp /etc/drachma/seed-node-1.conf /backup/location/
```

### Pruning (Optional)

If disk space is limited, enable pruning:

```bash
# Add to config
echo "prune=550" | sudo tee -a /etc/drachma/seed-node-1.conf

# Restart node
sudo systemctl restart drachma-seed-node-1
```

Note: Pruned nodes cannot serve full blockchain history to new peers.

## Security Hardening

### 1. Minimal RPC Exposure

Never expose RPC to the internet:
- Keep `rpcallowip=127.0.0.1` (localhost only)
- Use firewall rules to block port 8332 from external access

### 2. SSH Hardening

```bash
# Disable password authentication
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo systemctl restart sshd

# Use SSH keys only
# Install fail2ban for brute force protection
sudo apt-get install fail2ban
```

### 3. System Updates

```bash
# Enable automatic security updates
sudo apt-get install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

### 4. Resource Limits

The systemd service includes basic hardening:
- `PrivateTmp=true` - Isolated /tmp
- `NoNewPrivileges=true` - Cannot escalate privileges
- `ProtectSystem=full` - Read-only system directories
- `ProtectHome=true` - Cannot access /home

## DNS Seed Configuration

If you want your seed node to be a DNS seed (requires domain):

1. Set up DNS A/AAAA records pointing to your server IP
2. Configure reverse DNS (PTR record)
3. Submit PR to add your seed to `testnet/seeds.json`:

```json
{
  "host": "seed1.example.com",
  "port": 9333,
  "desc": "Community seed node - Example.com"
}
```

## Troubleshooting

### Node Won't Start

```bash
# Check logs
sudo journalctl -u drachma-seed-node-1 -n 100

# Check if port is already in use
sudo netstat -tulpn | grep 9333

# Verify binary
/usr/local/bin/drachmad --version
```

### Low Peer Count

```bash
# Check if port is open
sudo ufw status
telnet YOUR_PUBLIC_IP 9333

# Manually add peers
drachma-cli -conf=/etc/drachma/seed-node-1.conf addnode "seed.example.com:9333" "add"
```

### High Memory Usage

```bash
# Reduce dbcache in config
echo "dbcache=256" | sudo tee -a /etc/drachma/seed-node-1.conf
sudo systemctl restart drachma-seed-node-1
```

### Disk Space Issues

```bash
# Check space
df -h /var/lib/drachma-seed-node-1

# Enable pruning (see Pruning section above)
```

## Production Deployment Checklist

- [ ] Server meets minimum hardware requirements
- [ ] Static IP or reliable DNS configured
- [ ] Firewall rules configured (P2P port open, RPC port blocked)
- [ ] SSH hardened (key-only, fail2ban)
- [ ] Automatic security updates enabled
- [ ] Monitoring configured (logs, metrics)
- [ ] Backups configured (if storing wallet)
- [ ] Logrotate configured
- [ ] systemd service enabled for auto-start
- [ ] Initial sync completed
- [ ] Peer connections verified
- [ ] DNS record created (if applicable)
- [ ] Added to seeds.json (if applicable)

## Support

For seed node deployment issues:
- GitHub Issues: https://github.com/Tsoympet/PARTHENON-CHAIN/issues
- Discussions: https://github.com/Tsoympet/PARTHENON-CHAIN/discussions
- Security: security@drachma.org

## Recommended Seed Node Operators

Consider these factors when operating a seed node:
- Geographic diversity (different regions)
- Network diversity (different ISPs/data centers)
- Long-term commitment (keep node running 24/7)
- Monitoring and maintenance
- Timely updates

Thank you for supporting the PARTHENON CHAIN network!
